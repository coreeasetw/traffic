<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>本市 A1/A2 道路交通事故－按肇事場所別</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <style>
      body {
        padding: 30px 20px 60px;
        background: #f8f9fa;
        font-family: "Noto Sans TC", "Helvetica Neue", Arial, sans-serif;
      }

      h1 {
        font-weight: 600;
        margin-bottom: 10px;
      }

      .lead {
        max-width: 780px;
        color: #444;
      }

      .file-link {
        margin: 10px 0 25px;
      }

      .table-container {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 15px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      }

      thead th {
        background: #0d6efd;
        color: #fff;
      }

      .loading {
        color: #555;
        font-weight: 600;
      }

      .error {
        color: #b42318;
        font-weight: 600;
      }

      .summary {
        margin: 0 0 10px;
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1>本市 A1 / A2 道路交通事故－按肇事場所別（113 年）</h1>
      <p class="lead">
        此頁面將儲存庫中的原始 CSV 檔案以表格呈現，方便透過 GitHub Pages
        直接檢視或下載。資料來源：
        <strong>本市 A1 及 A2 類道路交通事故－按肇事場所別（113 年）</strong>。
      </p>
      <p class="file-link">
        <a
          class="btn btn-primary"
          href="./%E6%9C%AC%E5%B8%82A1%E5%8F%8AA2%E9%A1%9E%E9%81%93%E8%B7%AF%E4%BA%A4%E9%80%9A%E4%BA%8B%E6%95%85-%E6%8C%89%E8%82%87%E4%BA%8B%E5%A0%B4%E6%89%80%E5%88%A5(113%E5%B9%B4).csv"
          download
        >下載 CSV</a
        >
        <a class="btn btn-default" href="./index.html">返回事故儀表板</a>
      </p>

      <div class="table-container">
        <p id="summary" class="summary loading">載入資料中…</p>
        <div class="table-responsive">
          <table id="dataset" class="table table-striped table-hover">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      (async function loadDataset() {
        const summaryEl = document.getElementById("summary");
        const tableHead = document.querySelector("#dataset thead");
        const tableBody = document.querySelector("#dataset tbody");

        try {
          const response = await fetch(
            "./%E6%9C%AC%E5%B8%82A1%E5%8F%8AA2%E9%A1%9E%E9%81%93%E8%B7%AF%E4%BA%A4%E9%80%9A%E4%BA%8B%E6%95%85-%E6%8C%89%E8%82%87%E4%BA%8B%E5%A0%B4%E6%89%80%E5%88%A5(113%E5%B9%B4).csv"
          );

          if (!response.ok) {
            throw new Error("無法下載 CSV 檔案 (" + response.status + ")");
          }

          const text = await response.text();
          const lines = text.trim().split(/\r?\n/);
          if (lines.length === 0) {
            throw new Error("檔案為空");
          }

          const headers = lines[0].split(",");
          const rows = lines
            .slice(1)
            .map((line) => line.split(","))
            .filter((cols) => cols.length === headers.length);

          rows.sort((a, b) => Number(b[3] || 0) - Number(a[3] || 0));

          tableHead.innerHTML = "";
          const headerRow = document.createElement("tr");
          headers.forEach((title) => {
            const th = document.createElement("th");
            th.textContent = title;
            headerRow.appendChild(th);
          });
          tableHead.appendChild(headerRow);

          tableBody.innerHTML = "";
          rows.forEach((cols) => {
            const tr = document.createElement("tr");
            cols.forEach((value) => {
              const td = document.createElement("td");
              td.textContent = value;
              tr.appendChild(td);
            });
            tableBody.appendChild(tr);
          });

          summaryEl.textContent = "共 " + rows.length + " 筆紀錄，依件數排序顯示。";
          summaryEl.classList.remove("loading");
        } catch (err) {
          summaryEl.textContent = err.message;
          summaryEl.classList.remove("loading");
          summaryEl.classList.add("error");
        }
      })();
    </script>
  </body>
</html>
